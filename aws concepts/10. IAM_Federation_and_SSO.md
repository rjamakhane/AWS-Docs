# 🔐 AWS IAM Federation and SSO – Deep Dive Notes

> **File:** IAM_Federation_and_SSO.md  
> **Purpose:** Understand AWS Single Sign-On (SSO), Federation (SAML, OIDC), and real-world authentication patterns.

---

## 🌍 1. Overview

**Federation** allows **external identities** (like corporate users, Google accounts, or Azure AD users) to access AWS resources **without creating IAM users** in each AWS account.

AWS **SSO (IAM Identity Center)** simplifies user management across multiple AWS accounts and business applications.

---

## 🧩 2. Key Concepts

| Concept | Description |
|----------|--------------|
| **Federation** | Linking external identity providers (IdPs) to AWS |
| **SSO (Single Sign-On)** | Central login to access multiple AWS accounts or apps |
| **SAML 2.0** | XML-based federation protocol used by enterprise IdPs |
| **OIDC (OpenID Connect)** | JSON-based web federation standard, often used for mobile/web apps |
| **Web Identity Federation** | For third-party logins (Google, Facebook, Amazon) |
| **AWS STS** | Issues temporary credentials for federated users |

---

## 🔄 3. How Federation Works

Federation provides **temporary access via AWS STS (Security Token Service)**, using identity assertions from trusted IdPs.

### 🧱 Typical Flow
```
+-------------+           +-------------+           +------------------+
|  User logs  |  SAML/OIDC|  Identity   |  STS call |  AWS temporary    |
|  in to IdP  |──────────▶|  Provider   |──────────▶|  credentials      |
+-------------+           +-------------+           +------------------+
```

The external IdP authenticates the user, then AWS STS issues **temporary credentials** tied to a specific IAM Role.

---

## 🧠 4. SAML 2.0 Federation Flow

Used primarily for **enterprise identity providers** like **Okta, Azure AD, Google Workspace, or ADFS**.

### 🔹 Flow Diagram
```
[User] → [Corporate Login Page]
      → [SAML Assertion] → [AWS STS AssumeRoleWithSAML]
      → [Temporary Credentials]
      → [Access AWS Console/CLI]
```

### 🧩 Example Trust Policy for SAML Role
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Federated": "arn:aws:iam::123456789012:saml-provider/Okta"
      },
      "Action": "sts:AssumeRoleWithSAML"
    }
  ]
}
```

---

## ☁️ 5. OIDC Federation (OpenID Connect)

Used for **modern web and mobile applications** that need AWS access on behalf of authenticated users.

### 🔹 Flow Diagram
```
[Mobile/Web App] → [OIDC IdP (e.g. Google)] → [AWS STS AssumeRoleWithWebIdentity]
→ [Temporary Credentials] → [Access AWS APIs]
```

### 🧩 Example Trust Policy for OIDC Provider
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Federated": "arn:aws:iam::123456789012:oidc-provider/accounts.google.com"
      },
      "Action": "sts:AssumeRoleWithWebIdentity"
    }
  ]
}
```

---

## 🧱 6. AWS IAM Identity Center (SSO)

AWS **IAM Identity Center** (successor to AWS SSO) provides centralized access management for multiple AWS accounts.

| Feature | Description |
|----------|--------------|
| **Central Login** | Single user portal for all accounts |
| **Directory Integration** | Connects to Azure AD, Okta, or custom IdPs |
| **Fine-Grained Access** | Role-based permission sets per account |
| **Access Methods** | AWS Management Console, CLI, SDK |
| **Temporary Credentials** | Auto-issued per session |

---

## 🧰 7. Real-World Use Cases

| Use Case | Description |
|-----------|--------------|
| **Corporate SSO** | Employees log in via Okta, then access AWS Console using SAML |
| **Mobile App Integration** | App users log in via Google Sign-In (OIDC) to upload to S3 |
| **Cross-Organization Access** | Partner company users assume roles via federation |
| **Centralized Multi-Account Access** | Managed through IAM Identity Center |

---

## 🧭 8. Best Practices

| Best Practice | Description |
|----------------|-------------|
| **Use Identity Center for SSO** | Simplifies account access & role assignment |
| **Prefer Federation over IAM Users** | Avoid managing local credentials |
| **Leverage SAML for Enterprise, OIDC for Apps** | Match protocol to use case |
| **Audit via CloudTrail** | Track `AssumeRoleWithSAML` or `AssumeRoleWithWebIdentity` |
| **Use Conditional Policies** | Enforce MFA or session duration limits |

---

## 🎯 9. Certification Q&A

**Q1.** Which AWS service provides temporary credentials after federation?  
**A:** AWS Security Token Service (STS).

**Q2.** What’s the difference between SAML and OIDC?  
**A:** SAML uses XML, primarily for enterprise logins; OIDC uses JSON and is common for web/mobile apps.

**Q3.** Can an external user directly assume an IAM Role?  
**A:** Yes, through a **trust relationship** with a federated IdP.

**Q4.** What AWS service replaced AWS SSO?  
**A:** AWS **IAM Identity Center**.

---

## 🏁 10. Key Takeaways

- Federation enables **external identity access** without IAM users.  
- AWS supports **SAML 2.0, OIDC, and Web Identity Federation**.  
- **STS issues temporary credentials** for federated sessions.  
- **IAM Identity Center** is the modern solution for SSO across AWS accounts.  
- Use **OIDC for apps** and **SAML for enterprise integration**.

---

🔐 *End of Document*  
**File:** `IAM_Federation_and_SSO.md`
