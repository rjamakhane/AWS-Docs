# üßô‚Äç‚ôÇÔ∏è AWS IAM Roles ‚Äì Deep Dive Notes

> **File:** IAM_Roles.md  
> **Purpose:** Understand AWS IAM Roles, trust relationships, policies, and real-world use cases with certification-style insights.

---

## üß© 1. Overview

**IAM Roles** are identities within AWS that have specific permissions and are **assumed temporarily** by users, AWS services, or applications.  
Unlike IAM users, **roles do not have permanent credentials (passwords or access keys)**.

| Feature | Description |
|----------|--------------|
| **Purpose** | Provide temporary, delegated permissions |
| **Credentials** | Temporary security tokens (via STS) |
| **Assignable To** | AWS Services, IAM Users, Applications, or Federated Users |
| **Policy Type** | Attached policies + trust policy |
| **Scope** | Global (Account-level) |

---

## üß± 2. IAM User vs IAM Role

| Attribute | IAM User | IAM Role |
|------------|-----------|----------|
| **Identity Type** | Permanent | Temporary |
| **Credentials** | Username & Access Keys | STS Temporary Tokens |
| **Usage** | Human users | Services or cross-account entities |
| **Trust Policy** | ‚ùå No | ‚úÖ Yes |
| **When to Use** | For individuals | For service-to-service or cross-account access |

---

## üîê 3. Role Components

An IAM Role consists of **two key policy documents**:

| Policy Type | Purpose |
|--------------|----------|
| **Permissions Policy** | Defines what actions are allowed or denied |
| **Trust Policy** | Defines *who* can assume the role |

### üß© Example: Trust Policy
Allows an EC2 instance to assume a role.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "ec2.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```

### üîπ Example: Permissions Policy
Defines what the role can do once assumed.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::mybucket/*"
    }
  ]
}
```

---

## üß∞ 4. Common Role Types

| Role Type | Description | Example |
|------------|--------------|----------|
| **Service Role** | Used by AWS services to perform actions on your behalf | EC2 accessing S3 |
| **Cross-Account Role** | Allows access between AWS accounts | Account A allows Account B‚Äôs users to assume a role |
| **IAM Role for EC2** | EC2 instance automatically gets temporary credentials via metadata | Web app reading S3 data |
| **IAM Role for Lambda** | Lambda function accesses AWS resources | Lambda writing logs to CloudWatch |
| **Federated Role** | Used for external identity providers (e.g., Google, Azure AD) | SSO login via federation |

---

## üîÑ 5. Temporary Security Credentials (STS)

Roles use **AWS Security Token Service (STS)** to generate temporary credentials.

```bash
aws sts assume-role   --role-arn arn:aws:iam::123456789012:role/S3AccessRole   --role-session-name "DevSession"
```

Response includes:
```json
{
  "Credentials": {
    "AccessKeyId": "ASIA....",
    "SecretAccessKey": "abc....",
    "SessionToken": "FQoGZXIvYXdzEB....",
    "Expiration": "2025-10-28T21:00:00Z"
  }
}
```

‚è≥ These credentials are temporary and expire automatically (default 1 hour, configurable up to 12 hours).

---

## üß≠ 6. Best Practices for IAM Roles

| Best Practice | Description |
|----------------|-------------|
| **Use Roles over Keys** | Avoid hardcoded credentials in apps |
| **Restrict Trust Policies** | Limit which entities can assume the role |
| **Rotate Permissions Regularly** | Ensure least privilege |
| **Use CloudTrail** | Monitor `AssumeRole` events |
| **Attach Policies to Roles, not Services** | Ensures cleaner separation of permissions |

---

## üí° 7. Real-World Use Case

**Scenario:**  
A web application runs on **EC2 instances** and needs access to S3 to read/write objects.  

‚úÖ **Solution:**  
- Create an **IAM Role for EC2**.  
- Attach an **S3 Access Policy**.  
- Assign the role to the EC2 instance profile.  

The EC2 instance now retrieves **temporary credentials** automatically ‚Äî no need to store access keys.

---

## üéØ 8. Certification Q&A

**Q1.** Can an IAM Role be assumed by multiple services?  
**A:** ‚úÖ Yes, if allowed in the trust policy.

**Q2.** What is the difference between a trust policy and a permissions policy?  
**A:** Trust policy defines *who can assume* the role; permissions policy defines *what the role can do*.

**Q3.** Which service provides temporary credentials for IAM Roles?  
**A:** AWS STS (Security Token Service).

**Q4.** Should IAM Roles have long-term credentials?  
**A:** ‚ùå No, roles never have permanent keys or passwords.

---

## üèÅ 9. Key Takeaways

- IAM Roles = **temporary, delegated access**.  
- Use **Trust + Permissions policies** to control access.  
- Prefer **roles over access keys** for automation & apps.  
- STS issues **temporary tokens** with automatic expiry.  
- Crucial for **EC2, Lambda, Cross-account, and Federated access**.

---

üß≠ *End of Document*  
**File:** `IAM_Roles.md`
